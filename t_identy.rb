require "test/unit"
require "./identy.rb"

class TC < Test::Unit::TestCase
  def setup
    @o = Identy.new
  end

  def test_main
    assert_equal(
      ["EM,Z1,20170316,IM00002,Vitrea-20180713102058,DICOM,ST00001,SE00023,IM00002",
        "EM,Z1,20170316,IM00003,Vitrea-20180713102058,DICOM,ST00001,SE00023,IM00003",
        "EM,Z1,20170316,IM00004,Vitrea-20180713102058,DICOM,ST00001,SE00023,IM00004",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00023,IM00001",
        "EM,Z1,20170316,IM00002,Vitrea-20180713102058,DICOM,ST00001,SE00012,IM00002",
        "EM,Z1,20170316,IM00003,Vitrea-20180713102058,DICOM,ST00001,SE00012,IM00003",
        "EM,Z1,20170316,IM00004,Vitrea-20180713102058,DICOM,ST00001,SE00012,IM00004",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00012,IM00001",
        "EM,Z1,20170316,IM00002,Vitrea-20180713102058,DICOM,ST00001,SE00015,IM00002",
        "EM,Z1,20170316,IM00003,Vitrea-20180713102058,DICOM,ST00001,SE00015,IM00003",
        "EM,Z1,20170316,IM00004,Vitrea-20180713102058,DICOM,ST00001,SE00015,IM00004",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00015,IM00001",
        "EM,Z1,20170316,IM00002,Vitrea-20180713102058,DICOM,ST00001,SE00014,IM00002",
        "EM,Z1,20170316,IM00003,Vitrea-20180713102058,DICOM,ST00001,SE00014,IM00003",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00014,IM00001",
        "EM,Z1,20170316,IM00002,Vitrea-20180713102058,DICOM,ST00001,SE00022,IM00002",
        "EM,Z1,20170316,IM00003,Vitrea-20180713102058,DICOM,ST00001,SE00022,IM00003",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00022,IM00001",
        "EM,Z1,20170316,IM00002,Vitrea-20180713102058,DICOM,ST00001,SE00007,IM00002",
        "EM,Z1,20170316,IM00003,Vitrea-20180713102058,DICOM,ST00001,SE00007,IM00003",
        "EM,Z1,20170316,IM00004,Vitrea-20180713102058,DICOM,ST00001,SE00007,IM00004",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00007,IM00001",
        "EM,Z1,20170316,IM00002,Vitrea-20180713102058,DICOM,ST00001,SE00009,IM00002",
        "EM,Z1,20170316,IM00003,Vitrea-20180713102058,DICOM,ST00001,SE00009,IM00003",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00009,IM00001",
        "EM,Z1,20170316,IM00002,Vitrea-20180713102058,DICOM,ST00001,SE00008,IM00002",
        "EM,Z1,20170316,IM00003,Vitrea-20180713102058,DICOM,ST00001,SE00008,IM00003",
        "EM,Z1,20170316,IM00004,Vitrea-20180713102058,DICOM,ST00001,SE00008,IM00004",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00008,IM00001",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00001,IM00001",
        "EM,Z1,20170316,IM00002,Vitrea-20180713102058,DICOM,ST00001,SE00027,IM00002",
        "EM,Z1,20170316,IM00003,Vitrea-20180713102058,DICOM,ST00001,SE00027,IM00003",
        "EM,Z1,20170316,IM00004,Vitrea-20180713102058,DICOM,ST00001,SE00027,IM00004",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00027,IM00001",
        "EM,Z1,20170316,IM00002,Vitrea-20180713102058,DICOM,ST00001,SE00019,IM00002",
        "EM,Z1,20170316,IM00003,Vitrea-20180713102058,DICOM,ST00001,SE00019,IM00003",
        "EM,Z1,20170316,IM00004,Vitrea-20180713102058,DICOM,ST00001,SE00019,IM00004",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00019,IM00001",
        "EM,Z1,20170316,IM00002,Vitrea-20180713102058,DICOM,ST00001,SE00026,IM00002",
        "EM,Z1,20170316,IM00003,Vitrea-20180713102058,DICOM,ST00001,SE00026,IM00003",
        "EM,Z1,20170316,IM00004,Vitrea-20180713102058,DICOM,ST00001,SE00026,IM00004",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00026,IM00001",
        "EM,Z1,20170316,IM00002,Vitrea-20180713102058,DICOM,ST00001,SE00003,IM00002",
        "EM,Z1,20170316,IM00003,Vitrea-20180713102058,DICOM,ST00001,SE00003,IM00003",
        "EM,Z1,20170316,IM00004,Vitrea-20180713102058,DICOM,ST00001,SE00003,IM00004",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00003,IM00001",
        "EM,Z1,20170316,IM00002,Vitrea-20180713102058,DICOM,ST00001,SE00002,IM00002",
        "EM,Z1,20170316,IM00003,Vitrea-20180713102058,DICOM,ST00001,SE00002,IM00003",
        "EM,Z1,20170316,IM00004,Vitrea-20180713102058,DICOM,ST00001,SE00002,IM00004",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00002,IM00001",
        "EM,Z1,20170316,IM00002,Vitrea-20180713102058,DICOM,ST00001,SE00005,IM00002",
        "EM,Z1,20170316,IM00003,Vitrea-20180713102058,DICOM,ST00001,SE00005,IM00003",
        "EM,Z1,20170316,IM00004,Vitrea-20180713102058,DICOM,ST00001,SE00005,IM00004",
        "EM,Z1,20170316,IM00001,Vitrea-20180713102058,DICOM,ST00001,SE00005,IM00001",
        "CC,CC,20060714,US000001,US000001",
        "DeName-20180823.205517,DeId-20180823.205517,20180823,IM00002,Vitrea-20180826192330,DICOM,ST00001,SE00001,IM00002",
        "DeName-20180823.205517,DeId-20180823.205517,20180823,IM00001,Vitrea-20180826192330,DICOM,ST00001,SE00001,IM00001",
        "CC,CC,20060714,US000001.org,US000001.org",
        "20180824.145047.Name,20180824.145047.ID,20180824,IM00001,Vitrea-20180824151159,DICOM,ST00001,SE00001,IM00001",
        "20180824.145047.Name,20180824.145047.ID,20180824,IM00002,Vitrea-20180824151159,DICOM,ST00001,SE00003,IM00002",
        "20180824.145047.Name,20180824.145047.ID,20180824,IM00001,Vitrea-20180824151159,DICOM,ST00001,SE00003,IM00001",
        "20180824.145047.Name,20180824.145047.ID,20180824,IM00001,Vitrea-20180824151159,DICOM,ST00001,SE00002,IM00001",
        "USS-V2.5-171117-01 SPL.IMAGE LN^FOR USS44G  FN^MI,USS56-V2.5SP0001-SPL.IMAGE,20171208,A0000,DICOM,DATA,20171211,194331,A0000",
        "USS-V2.5-171117-01 SPL.IMAGE LN^FOR USS44G  FN^MI,USS56-V2.5SP0001-SPL.IMAGE,20171208,A0001,DICOM,DATA,20171211,194331,A0001"],
       @o.main)
  end

  def test_dcm_dirs
    @o.dbg_chdir("/Users/shouichi/ruby/src/identy/DicomFiles/DICOM/")
    assert_equal([["DATA", nil, nil, nil],
      ["DATA", nil, nil, nil],
      ["DATA", nil, nil, nil],
      ["DATA",
       "USS-V2.5-171117-01 SPL.IMAGE LN^FOR USS44G  FN^MI",
       "USS56-V2.5SP0001-SPL.IMAGE",
       "20171208"],
      ["DATA",
       "USS-V2.5-171117-01 SPL.IMAGE LN^FOR USS44G  FN^MI",
       "USS56-V2.5SP0001-SPL.IMAGE",
       "20171208"]], @o.dcm_dirs)
    @o.dbg_chdir("/Users/shouichi/ruby/src/identy/DicomFiles/Vitrea-20180713102058")
    assert_equal([["DICOMDIR", nil, nil, nil],
      ["DICOM", nil, nil, nil],
      ["DICOM", nil, nil, nil],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", nil, nil, nil],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"],
      ["DICOM", "EM", "Z1", "20170316"]], @o.dcm_dirs)
  end

  def test_convert_cvs
    assert_equal( ["DICOM,EM,Z1,20170316","1,2,3,4"], @o.convert_cvs([["DICOM", "EM", "Z1", "20170316"],["DICOM", nil, nil, nil],["DICOM", "EM", "Z1", "20170316"],["DICOM", nil, nil, nil],["1","2","3","4"]]))
  end

  def test_idx
    assert_equal("foo", @o.idx("foo/bar/fofofo.txt"))
  end

  def test_gather_nil
    assert_equal( [["DICOM", nil, nil, nil]], @o.gather_nil([["DICOM", "EM", "Z1", "20170316"],["DICOM", nil, nil, nil]]))
  end

  def test_write_cvs
    assert_equal(nil, @o.write_cvs(["1,2,3,4","9,9,9,9"]))
  end

end
